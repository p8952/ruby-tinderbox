/*
flot-tickrotor: flot plugin to display angled X-axis tick labels.
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this file,
You can obtain one at http://mozilla.org/MPL/2.0/. 
*/

(function(e){function n(t){var n=[];var r;var i=false;var s,o,u;t.hooks.draw.push(function(t,a){var f;if(!i){var l=t.getAxes().xaxis.options;if(l.rotateTicks===undefined){return}s=parseInt(l.rotateTicks,10);if(s.toString()!=l.rotateTicks||s==0||s>=180){return}o=s*Math.PI/180;if(s>90){u=Math.PI-o}else{u=Math.PI/2-o}r=l.rotateTicksFont;if(!r){r=e(".tickLabel").css("font")}if(!r){r="smaller sans-serif"}var c,h=0,p=0,d=0,v=0;f=t.getAxes().xaxis;n=t.getAxes().xaxis.ticks;f.rotatedTicks=n;l.ticks=[];var m;for(var g=0;g<n.length;g++){c=e('<span style="font:'+r+'">'+n[g].label+"</span>");t.getPlaceholder().append(c);n[g].height=c.outerHeight(true);n[g].width=c.outerWidth(true);c.remove();if(n[g].height>p){p=n[g].height}if(n[g].width>h){h=n[g].width}var y=n[g];if(s>90){m=Math.round(t.getPlotOffset().left+f.p2c(y.v))-Math.ceil(Math.cos(u)*y.height)-Math.ceil(Math.cos(u)*y.width);if(m<d){d=m}}else{m=Math.round(t.getPlotOffset().left+f.p2c(y.v))+Math.ceil(Math.cos(u)*y.height)+Math.ceil(Math.cos(u)*y.width);if(m>v){v=m}}}if(s>90){var b=o-Math.PI/2;l.labelHeight=Math.ceil(Math.sin(b)*h)+Math.ceil(Math.sin(b)*p)}else{var b=Math.PI/2-o;l.labelHeight=Math.ceil(Math.sin(o)*h)+Math.ceil(Math.sin(b)*p)}if(d<0){t.getAxes().yaxis.options.labelWidth=-1*d}i=true;t.setupGrid();t.draw()}else{if(n.length==0){return}f=t.getAxes().xaxis;var w=f.box;var y,E,S,x;for(var g=0;g<n.length;g++){y=n[g];if(!y.label){continue}a.save();a.font=r;if(s<=90){S=-Math.ceil(Math.cos(u)*y.height);x=Math.ceil(Math.sin(u)*y.height);a.translate(Math.round(t.getPlotOffset().left+f.p2c(y.v))+S,w.top+w.padding+t.getOptions().grid.labelMargin+x);a.rotate(o)}else{S=Math.ceil(Math.cos(u)*y.height)-Math.ceil(Math.cos(u)*y.width);x=Math.ceil(Math.sin(u)*y.width)+Math.ceil(Math.sin(u)*y.height);a.translate(Math.round(t.getPlotOffset().left+f.p2c(y.v)+S),w.top+w.padding+t.getOptions().grid.labelMargin+x);a.rotate(-u)}a.fillText(y.label,0,0);a.restore()}}})}var t={};e.plot.plugins.push({init:n,options:t,name:"tickRotor",version:"1.0"})})(jQuery)
